"use strict";angular.module("loginFrontend",["ui.router","vcRecaptcha","gettext","ui.bootstrap","ngCookies","ng-analytics"]).config(["$locationProvider","$urlRouterProvider","$stateProvider","$logProvider","$httpProvider",function($locationProvider,$urlRouterProvider,$stateProvider,$logProvider,$httpProvider){$locationProvider.html5Mode(!0),$urlRouterProvider.otherwise("/"),$logProvider.debugEnabled(!1),$stateProvider.state("login",{url:"/form",templateUrl:"login.tpl.html",controller:"LoginController",reloadOnSearch:!1}).state("sms-verification",{url:"/sms-verification",params:{phoneMask:null,redirectUrl:null,sendSmsErrorCode:null,totpAuthenticationEnabled:null},views:{"":{templateUrl:"smsVerification.tpl.html",controller:"SmsVerificationCtrl"}}}).state("totp-verification",{url:"/totp-verification",params:{phoneMask:null,redirectUrl:null},views:{"":{templateUrl:"totpVerification.tpl.html",controller:"TotpVerificationCtrl"}}}),$httpProvider.defaults.xsrfCookieName="CSRF-TOKEN",$httpProvider.defaults.xsrfHeaderName="CSRF-TOKEN"}]).run(["$log","gettextCatalog",function($log,gettextCatalog){$log.debug("App is working");var languageTag=document.documentElement.lang;gettextCatalog.setCurrentLanguage(languageTag),gettextCatalog.debug=!1}]),angular.module("loginFrontend").service("BuyProcessService",["$cookies","$log","$window","CookieMonsterService","ReferrerService",function($cookies,$log,$window,cookieMonsterService,referrerService){this.buyWithoutLogin=function(formData){if($log.debug("cartWithoutLogin"),cookieMonsterService.sendPurchasingProcessLogInEvent("guest",referrerService.isCartPreviousPage()),formData.buyConfig.cartBuyAsGuestEnabled)$log.debug("guestCartProcess"),$window.location.href=formData.buyConfig.cartBuyAsGuestUrl;else if(formData.buyConfig.buyNowGuestBoxEnabled)if($log.debug("buyNowProcess"),formData.buyConfig.buyNowAsGuestUrl)$window.location.href=formData.buyConfig.buyNowAsGuestUrl;else{var cartClient=new CartClient($cookies.get("cartUserId"),"/cart","/carts/");cartClient.addItemToCartWithoutExtraData(formData.buyConfig.buyNowOfferId,formData.buyConfig.buyNowItemQuantity,function(){return"ssl"===location.host.split(".")[0]?void location.replace("http://"+location.host.substring(4)+"/cart"):void location.replace("http://"+location.host+"/cart")})}}}]),angular.module("loginFrontend").service("CookieMonsterService",["$http","$log","PhishingHashService",function($http,$log,phishingHashService){function sendCookieMonsterEvent(category,action,label,value,customParams){var eventData={category:category,action:action};label&&(eventData.label=label),value&&(eventData.value=value),customParams&&(eventData.customParams=customParams),cm("send","event",eventData)}return{getCookieMonsterParamsAndSendPageView:function(){$http.get("/login/cookieMonsterParams").then(function(response){cm("create",response.data.cookieMonsterAccount),cm("send","pageview",{customParams:{hash:phishingHashService.getHash()}})},function(response){$log.debug("Failed to get Cookie Monster params ",response)})},send2FAVerifiedEvent:function(type,markDeviceAsTrusted){this.sendLoginPageEvent("2FAVerification",{type:type,markDeviceAsTrusted:markDeviceAsTrusted,template:"vela"})},sendLoginPageEvent:function(action,customParams){sendCookieMonsterEvent("LoginPage",action,null,null,customParams)},sendPurchasingProcessLogInEvent:function(label,isCartPreviousPage){sendCookieMonsterEvent("PurchasingProcess","LogIn",label,null,{entry:isCartPreviousPage?"CART":"UNKNOWN",hash:phishingHashService.getHash()})}}}]),angular.module("loginFrontend").factory("FPService",["$window","ValveFingerprintjs2",function($window,valveFingerprintjs2){var service={_fp:null,get:function(){return this._fp},init:function(){valveFingerprintjs2.get(function(result){this._fp=result}.bind(this))}};return service.init(),service}]),angular.module("loginFrontend").service("GoogleTagManagerService",["$http","$log","GtmSvc",function($http,$log,GtmSvc){return{getGoogleTagManagerParamsAndInitialize:function(){$http.get("/login/googleTagManagerParams").then(function(response){var config={active:response.data.googleTagManagerEnabled,account:response.data.googleTagManagerAccount};GtmSvc.initialize(config)},function(response){$log.debug("Failed to get Google Tag Manager params ",response)})}}}]),angular.module("loginFrontend").controller("LoginController",["$scope","$injector","PromoService","BuyProcessService","CookieMonsterService","ReferrerService","PerformanceMarkService","GoogleTagManagerService","TranslatorService","PhishingHashService","$location","$log","$http","$window","$uibModal","$state","$document",function($scope,$injector,promoService,buyProcessService,cookieMonsterService,referrerService,performanceMarkService,googleTagManagerService,translatorService,phishingHashService,$location,$log,$http,$window,$uibModal,$state,$document){function scrollToElement(selector){var element=$document.get(0).querySelector(selector);element&&("function"==typeof element.scrollIntoViewIfNeeded?element.scrollIntoViewIfNeeded():"function"==typeof element.scrollIntoView&&element.scrollIntoView())}$log.debug("LoginController"),$scope.formData={showAd:!1,showGuestForm:!1,adsConfig:null,urlsConfig:null,addsConfig:{tagId:"login_page_500_380",unitPath:"/21612525419/Allegro.pl/loginpage/500x380_loginbox",sizes:[[500,380]],targeting:[],sizeMapping:[{viewport:[0,0],sizes:[]},{viewport:[1024,600],sizes:[[500,380]]}]},buyConfig:{cartBuyAsGuestUrl:"",buyNowAsGuestUrl:"",cartBuyAsGuestEnabled:!1,buyNowGuestBoxEnabled:!1,buyNowOfferId:0,buyNowItemQuantity:0},agreementVersion:{available:!1,changeDate:null},facebookEnabled:!1,fingerprintEnabled:!1};var getDataUrl=function(){var path="/login/data";return $location.search().authorization_uri?path+"?authorization_uri="+encodeURIComponent($location.search().authorization_uri):path},fpService=null;$http.get(getDataUrl()).then(function(response){$log.debug("Get form data success",response),$scope.formData=response.data,$scope.formData.showAd=!$scope.formData.showGuestForm,$scope.formData.showAd&&(promoService.showAd("login_page_500_380",500,380),promoService.showAd("login_page_statistics_1_1",1,1)),$scope.formData.fingerprintEnabled&&(fpService=$injector.get("FPService"))},function(response){$log.debug("Get form data failed",response)}),$scope.recaptchaStatus={empty:!0,showRequired:!1,isValid:function(){return!$scope.loginFailure.showRecaptcha||!this.empty},resetCaptcha:function(){$scope.loginFailure.showRecaptcha&&grecaptcha.reset()}},$scope.openPendingRegistrationModal=function(){$uibModal.open({animation:!0,templateUrl:"pendingRegistrationModal.tpl.html",controller:"PendingRegistrationModalInstanceCtrl",windowClass:"info-modal",resolve:{email:function(){return $scope.loginFailure.pendingRegistrationEmail}}})},$scope.handleRedirect=function(responseData){responseData.totpAuthenticationEnabled?$state.go("totp-verification",{phoneMask:responseData.phoneMask,redirectUrl:responseData.redirectUrl,smsCodeAuthenticationEnabled:responseData.smsCodeAuthenticationEnabled}):responseData.smsCodeAuthenticationEnabled?$state.go("sms-verification",{phoneMask:responseData.phoneMask,redirectUrl:responseData.redirectUrl,sendSmsErrorCode:translatorService.translateSmsError(responseData.sendSmsErrorCode),totpAuthenticationEnabled:responseData.totpAuthenticationEnabled}):$window.location.href=responseData.redirectUrl},$scope.loginFailure={showRecaptcha:!1,recaptchaError:!1,sendSmsErrorCode:null,lastFailed:!1,pendingRegistrationEmail:null,formExpired:!1,passwordChangeUrl:null},$scope.showSpinner=!1,$scope.captchaSuccessCallback=function(){$scope.recaptchaStatus.empty=!1,$scope.recaptchaStatus.showRequired=!1},$scope.captchaExpirationCallback=function(){$scope.recaptchaStatus.empty=!0},$scope.logIn=function(form){if($log.debug(form),form.password.$dirty=!0,form.username.$dirty=!0,$scope.recaptchaStatus.isValid()){if(form.$valid){$scope.hideAlert=!0,$scope.showSpinner=!0,$log.debug("Form is submit");var recaptchaResponse=document.querySelector("#g-recaptcha-response"),headers={"Content-Type":"application/json"};fpService&&$scope.formData.fingerprintEnabled&&(headers["X-FP"]=fpService.get());var request={method:"POST",url:"/login/authenticate",headers:headers,data:{username:$scope.login,password:$scope.password,recaptchaResponse:recaptchaResponse?recaptchaResponse.value:null,authorizationUri:$location.search().authorization_uri,authenticationMethod:"CREDENTIALS"}};$http(request).then(function(response){$log.debug("Login success",response),cookieMonsterService.sendPurchasingProcessLogInEvent("user",referrerService.isCartPreviousPage()),cookieMonsterService.sendLoginPageEvent("SuccessfulLogin",{userId:response.data.userId,hash:phishingHashService.getHash()}),$scope.handleRedirect(response.data)},function(response){$scope.hideAlert=!1,$log.debug("Login failed",response.data),cookieMonsterService.sendLoginPageEvent("LoginFailed"),$scope.showSpinner=!1,$scope.recaptchaStatus.resetCaptcha(),$scope.password="",form.$setPristine(),setTimeout(function(){scrollToElement(".js-error")},0),403==response.data.status?$scope.loginFailure.formExpired=!0:401==response.data.status&&($scope.loginFailure=JSON.parse(response.data.message),null!=$scope.loginFailure.pendingRegistrationEmail?$scope.openPendingRegistrationModal():$scope.loginFailure.sendSmsErrorCode?$scope.handleRedirect($scope.loginFailure):null!=$scope.loginFailure.passwordChangeUrl&&($window.location.href=$scope.loginFailure.passwordChangeUrl),$log.debug("Failure ",$scope.loginFailure))})}}else $scope.recaptchaStatus.showRequired=!0},$scope.buyWithoutLogin=function(){buyProcessService.buyWithoutLogin($scope.formData)},performanceMarkService.reportFirstMeaningfulPaint(),cookieMonsterService.getCookieMonsterParamsAndSendPageView(),googleTagManagerService.getGoogleTagManagerParamsAndInitialize()}]),angular.module("loginFrontend").controller("PendingRegistrationModalInstanceCtrl",function($scope,$uibModalInstance,email){$scope.email=email,$scope.ok=function(){$uibModalInstance.close()}}),angular.module("loginFrontend").service("PerformanceMarkService",["$window",function($window){return{reportFirstMeaningfulPaint:function(){$window.performance&&"function"==typeof $window.performance.mark&&"function"==typeof $window.requestAnimationFrame&&$window.requestAnimationFrame(function(){$window.performance.mark("FirstMeaningfulPaint")})}}}]),angular.module("loginFrontend").service("PhishingHashService",[function(){return{getHash:function(){return $("body").data("m-front-main")?$("html").data("front-main")+$("body").data("s-front-main"):null}}}]),angular.module("loginFrontend").service("PromoService",["$window",function($window){return{showAd:function(placementId,width,height){var adsDiv=document.getElementById("ads");$window.pl_allegro_advertising_showcase&&$window.pl_allegro_advertising_showcase[placementId]&&$window.pl_allegro_advertising_showcase[placementId](adsDiv)}}}]),angular.module("loginFrontend").service("ReferrerService",["$window",function($window){this.getReferrer=function(){return $window.document&&$window.document.referrer?$window.document.referrer:""},this.isCartPreviousPage=function(){var referrer=this.getReferrer();return""!==referrer&&-1!==referrer.indexOf("/cart")}}]),angular.module("loginFrontend").controller("SmsVerificationCtrl",["$scope","$stateParams","$window","$http","$log","$state","TranslatorService","CookieMonsterService",function($scope,$stateParams,$window,$http,$log,$state,translatorService,cookieMonsterService){var redirectUrl=$stateParams.redirectUrl;$scope.phoneMask=$stateParams.phoneMask,$scope.sendSmsErrorCode=$stateParams.sendSmsErrorCode,$scope.totpAuthenticationEnabled=$stateParams.totpAuthenticationEnabled,$scope.markDeviceAsTrusted=!0,$("#smsCode").focus(),$scope.ok=function(){$scope.hideAlert=!0;var request={method:"POST",url:"/login/authenticate",headers:{"Content-Type":"application/json"},data:{smsCode:$scope.smsCode,authorizationUri:redirectUrl,markDeviceAsTrusted:$scope.markDeviceAsTrusted,authenticationMethod:"SMS_CODE"}};$http(request).then(function(response){$log.debug("Sms verification login success",response),cookieMonsterService.send2FAVerifiedEvent("sms",$scope.markDeviceAsTrusted),$window.location.href=response.data.redirectUrl},function(response){var responseMessage=JSON.parse(response.data.message);$log.debug("Sms verification login failed",response),401===response.data.status&&null!==responseMessage.passwordChangeUrl&&($window.location.href=responseMessage.passwordChangeUrl),$scope.hideAlert=!1,$scope.smsValidationError=translatorService.translateSmsError(responseMessage.smsValidationError)})},$scope.goToTotpVerification=function(){$state.go("totp-verification",{phoneMask:$scope.phoneMask,redirectUrl:redirectUrl})},$scope.cancel=function(){$window.location.href="/"}}]),angular.module("loginFrontend").run(["$templateCache",function($templateCache){$templateCache.put("login.tpl.html",'<header class="page-header separator separator-bottom col-sm-12 col-md-12">\n\n    <div ng-if="!formData.showGuestForm" class="col-sm-9 col-sm-offset-1 col-md-12 col-md-offset-0">\n        <h1>\n            <span translate>loginFrontend.loginHeader</span>\n            <small>\n                <a id="new-account-link" href="{{formData.signUpUrl}}" translate>loginFrontend.noAccount</a>\n            </small>\n        </h1>\n    </div>\n\n    <div ng-if="formData.showGuestForm" class="col-sm-9 col-sm-offset-1 col-md-12 col-md-offset-0 guest-login-header">\n        <h1 class="col-md-3" translate>loginFrontend.guestFormLoginHeader</h1>\n        <div class="col-md-offset-6 visible-md visible-lg">\n            <h1 translate>loginFrontend.newGuestBuyWithoutLoginName</h1>\n        </div>\n    </div>\n</header>\n<div class="row relative">\n    <div class="col-xs-12 col-ss-12 col-sm-12 col-md-6 separator separator-right">\n        <div class="center-block login-form">\n            <form name="loginForm" novalidate="" role="form" class="alle-form form-horizontal" ng-submit="logIn(loginForm)" method="post" id="authForm">\n                <div ng-if="loginFailure.lastFailed && !loginFailure.recaptchaError" class="form-group" ng-cloak="">\n                    <div class="col-xm-10 col-xm-offset-1 col-xs-8 col-xs-offset-2 col-sm-10 col-sm-offset-3 col-md-8 col-md-offset-4">\n                        <div class="recaptcha-width alert alert-danger pull-left js-error" ng-class="{ \'hide-alert\': hideAlert }">\n                            <h4 translate>loginFrontend.errorTitle</h4>\n                            <span translate>loginFrontend.errorMessage</span>\n                        </div>\n                    </div>\n                </div>\n\n                <div ng-if="loginFailure.recaptchaError" class="form-group" ng-cloak="">\n                    <div class="col-xm-10 col-xm-offset-1 col-xs-8 col-xs-offset-2 col-sm-10 col-sm-offset-3 col-md-8 col-md-offset-4">\n                        <div class="recaptcha-width alert alert-danger pull-left js-error" ng-class="{ \'hide-alert\': hideAlert }">\n                            <h4 translate>loginFrontend.errorCaptchaTitle</h4>\n                            <span translate>loginFrontend.errorCaptchaMessage</span>\n                        </div>\n                    </div>\n                </div>\n\n                <div ng-if="loginFailure.formExpired" class="form-group" ng-cloak="">\n                    <div class="col-xm-10 col-xm-offset-1 col-xs-8 col-xs-offset-2 col-sm-10 col-sm-offset-3 col-md-8 col-md-offset-4">\n                        <div class="recaptcha-width alert alert-danger pull-left js-error" ng-class="{ \'hide-alert\': hideAlert }">\n                            <span translate>loginFrontend.formExpired</span>\n                        </div>\n                    </div>\n                </div>\n\n                <div class="form-group input-group-validation">\n                    <label translate class="col-xm-10 col-xm-offset-1 col-xs-8 col-xs-offset-2 col-sm-2 col-sm-offset-1 col-md-4 col-md-offset-0 control-label">\n                        loginFrontend.loginEmailLabel\n                    </label>\n\n                    <div class="col-xm-10 col-xm-offset-1 col-xs-8 col-xs-offset-2 col-sm-8 col-sm-offset-0 col-md-8 col-md-offset-0">\n                        <input name="username" id="username" ng-model="login" type="text" autofocus="autofocus" tabindex="1" maxlength="63" required="required" class="recaptcha-width form-control"/>\n\n                        <div ng-if="loginForm.username.$invalid && loginForm.$submitted" class="recaptcha-width validation-message in" ng-cloak="">\n                            <div id="wrong-login-message" translate>loginFrontend.loginEmailErrorMessage</div>\n                        </div>\n                    </div>\n                </div>\n                <div class="form-group input-group-validation">\n                    <label translate class="col-xm-10 col-xm-offset-1 col-xs-8 col-xs-offset-2 col-sm-2 col-sm-offset-1 col-md-4 col-md-offset-0 control-label">\n                        loginFrontend.passwordLabel\n                    </label>\n\n                    <div class="col-xm-10 col-xm-offset-1 col-xs-8 col-xs-offset-2 col-sm-8 col-sm-offset-0 col-md-8 col-md-offset-0">\n                        <input  name="password" id="password" ng-model="password" type="password" tabindex="2" maxlength="16" required="required" class="recaptcha-width form-control"/>\n\n                        <div ng-if="loginForm.password.$invalid && loginForm.$submitted" class="recaptcha-width validation-message in" ng-cloak="">\n                            <div id="wrong-password-message" translate>loginFrontend.passwordErrorMessage</div>\n                        </div>\n                    </div>\n                </div>\n                <div class="row">\n                    <div class="col-xm-10 col-xm-offset-1 col-xs-8 col-xs-offset-2 col-sm-offset-3 col-sm-8 col-md-offset-4 col-md-8 reminder-link">\n                        <div class="recaptcha-width">\n                            <a href="{{formData.passwordReminderUrl}}" class="pull-right" translate>loginFrontend.passwordReminder</a>\n                        </div>\n                    </div>\n                </div>\n                <div class="form-group input-group-validation" ng-if="loginFailure.showRecaptcha">\n                    <label translate class="col-xm-10 col-xm-offset-1 col-xs-8 col-xs-offset-2 col-sm-2 col-sm-offset-1 col-md-4 col-md-offset-0 control-label">\n                        loginFrontend.captchaLabel\n                    </label>\n\n                    <div class="col-xm-10 col-xm-offset-1 col-xs-8 col-xs-offset-2 col-sm-8 col-sm-offset-0 col-md-8 col-md-offset-0">\n                        <div\n                                vc-recaptcha="vc-recaptcha"\n                                key="\'6Lf2QRITAAAAALCZv7ic-HUmW8z5Ae64h5a7umyb\'"\n                                on-success="captchaSuccessCallback()"\n                                on-expire="captchaExpirationCallback()">\n                        </div>\n                        <div ng-if="recaptchaStatus.showRequired" class="recaptcha-width validation-message in" ng-cloak="">\n                            <div id="captcha-required" translate>loginFrontend.captchaRequired</div>\n                        </div>\n                    </div>\n                </div>\n                <div class="form-group">\n                    <div class="col-xm-10 col-xm-offset-1 col-xs-8 col-xs-offset-2 col-sm-offset-3 col-sm-8 col-md-offset-4 col-md-8">\n                        <button\n                            tabindex="4"\n                            type="submit"\n                            class="recaptcha-width btn btn-primary btn-block btn btn-primary spinner"\n                            ng-disabled="showSpinner"\n                            id="login-button"\n                            translate\n                        >loginFrontend.loginButton</button>\n                        <button\n                            tabindex="5"\n                            type="button"\n                            class="recaptcha-width btn btn-primary btn-block hidden-md hidden-lg"\n                            ng-if="formData.showGuestForm"\n                            ng-click="buyWithoutLogin()"\n                            translate\n                        >loginFrontend.buyWithoutLoginButton</a>\n                    </div>\n                </div>\n                <div ng-if="formData.facebookEnabled" class="form-group">\n                    <div class="col-xm-10 col-xm-offset-1 col-xs-8 col-xs-offset-2 col-sm-offset-3 col-sm-8 col-md-offset-4 col-md-8">\n                        <a href="#" class="recaptcha-width btn btn-social btn-block" ng-click="loginWithFacebook()"><span class="icons social-icons icon-facebook"></span><span translate>loginFrontend.loginWithFacebookButton</span></a>\n                    </div>\n                    <div class="col-xm-10 col-xm-offset-1 col-xs-8 col-xs-offset-2 col-sm-offset-3 col-sm-8 col-md-offset-4 col-md-7 text-center">\n                        <div class="recaptcha-width"><span class="didascalia" translate>loginFrontend.facebookPermissionDidascalia</span></div>\n                    </div>\n                </div>\n                <br/>\n            </form>\n            <div class="alert alert-success">\n                <b>Już niedługo zmienimy wygląd strony logowania.</b>\n                Logowanie będzie wygodniejsze, a poziom bezpieczeństwa pozostanie ten sam.\n            </div>\n        </div>\n    </div>\n\n    <div class="col-xs-12 col-ss-12 col-sm-12 col-md-6">\n\n        <div class="guest-login-container visible-md visible-lg" ng-if="formData.showGuestForm">\n            <div class="new-guest-info">\n                <p class="new-guest-info-note" translate>loginFrontend.newGuestLoginNote1</p>\n                <p translate>loginFrontend.newGuestLoginNote2</p>\n                <p>\n                    <span translate>loginFrontend.newGuestLoginNote3</span>\n                <div class="separator separator-top separator-with-label">\n                    <span class="separator-label" translate>loginFrontend.orSeparator</span>\n                </div>\n                <span translate>loginFrontend.newGuestLoginNote4</span>\n                </p>\n            </div>\n            <div class="form-group">\n                <div class="col-xs-10 col-ss-10 col-sm-7 col-md-7">\n                    <button\n                        type="submit"\n                        class="btn btn-primary btn-block recaptcha-width"\n                        id="login-button-guest"\n                        translate\n                        ng-click="buyWithoutLogin()"\n                    >loginFrontend.buyWithoutLoginButton</button>\n                </div>\n            </div>\n        </div>\n\n        <div ng-show="formData.showAd" class="ads">\n            <div class="text-center">\n                <dfp dfp-config="formData.addsConfig"></dfp>\n            </div>\n        </div>\n    </div>\n</div>\n\n<div class="form-group">\n    <div class="user-agreement recaptcha-width col-xm-10 col-xm-offset-1 col-xs-8 col-xs-offset-2 col-sm-offset-3 col-sm-8 col-md-offset-2 col-md-7 text-center">\n        <small>\n            <span translate>loginForm.userAgreementFirstPart</span>\n            <a href="{{formData.urlsConfig.agreement}}">\n                <span translate>loginForm.userAgreementSecondPart</span>\n            </a><br/>\n            <span translate>loginForm.userAgreementThirdPart</span>\n            <br/><br/>\n            <a href="{{formData.urlsConfig.news}}">\n                <span ng-if="formData.agreementVersion.available"><translate>loginFrontend.userAgreementLastUpdate</translate> {{formData.agreementVersion.changeDate}}</span>\n                <span ng-if="!formData.agreementVersion.available" translate>loginFrontend.userAgreementLastUpdateWithoutDate</span>\n            </a>\n        </small>\n    </div>\n</div>\n'),$templateCache.put("pendingRegistrationModal.tpl.html",'<div class="modal-header">\n    <button type="button" class="btn-close" ng-click="ok()"><i class="icon-back"></i></button>\n    <h4 class="modal-title" translate>loginFrontend.confirmEmail</h4>\n</div>\n<div class="modal-body">\n    <br/>\n    <translate>loginFrontend.registrationIncomplete</translate>\n    <br/>\n    <p id="pending-email"><b>{{email}}</b></p>\n    <br/>\n    <translate>loginFrontend.registrationIncompleteInfo</translate>\n</div>\n<div class="modal-footer">\n    <button type="button" data-dismiss="modal" ng-click="ok()" class="btn btn-primary" translate>loginFrontend.ok</button>\n    <button type="button" class="btn btn-link center-block" ng-click="ok()" translate>loginFrontend.cancel</button>\n</div>\n'),$templateCache.put("smsVerification.tpl.html",'<header class="page-header separator separator-bottom col-sm-12 col-md-12 ng-scope">\n    <div class="col-sm-9 col-sm-offset-1 col-md-12 col-md-offset-0 ng-scope">\n        <h1 class="page-default" translate>loginFrontend.provideSmsCode</h1>\n    </div>\n</header>\n\n<div class="form-center">\n\n    <div ng-if="sendSmsErrorCode" class="form-group" ng-cloak="">\n        <div class="col-xm-10 col-xm-offset-1 col-sm-8 col-sm-offset-4 error-box">\n            <div class="alert alert-danger pull-left" ng-class="{ \'hide-alert\': hideAlert }">\n                <h4 translate>loginFrontend.smsErrorTitle</h4>\n                <span>{{sendSmsErrorCode}}</span>\n            </div>\n        </div>\n        <!--\n        <span translate>loginFrontend.CODE_SENDING_LIMIT_EXCEEDED</span>\n        <span translate>loginFrontend.UNEXPECTED_ERROR</span>\n        <span translate>loginFrontend.INVALID_CODE</span>\n        <span translate>loginFrontend.CODE_EXPIRED</span>\n        <span translate>loginFrontend.PHONE_NUMBER_NOT_FOUND</span>\n        <span translate>loginFrontend.PHONE_NUMBER_ON_BLACKLIST</span>\n        <span translate>loginFrontend.CODE_VERIFICATION_LIMIT_EXCEEDED</span>\n        -->\n    </div>\n    <div ng-if="smsValidationError" class="form-group" ng-cloak="">\n        <div class="col-xm-10 col-xm-offset-1 col-sm-8 col-sm-offset-4 error-box">\n            <div class="alert alert-danger pull-left" ng-class="{ \'hide-alert\': hideAlert }">\n                <h4 translate>loginFrontend.smsValidationErrorTitle</h4>\n                <span>{{smsValidationError}}</span>\n            </div>\n        </div>\n    </div>\n\n    <div class="row vertical-align spacer col-sm-12 col-xs-12">\n        <div class="col-xs-4 text-right">\n            <!-- TODO: change image and path -->\n            <img class="phone-icon" src="dist/images/ic-sms.png">\n        </div>\n\n        <div class="col-xs-8 text-center send-code-to-number">\n            <strong>\n                <span translate>loginFrontend.codeSentToNumber</span>\n                {{phoneMask}}\n            </strong>\n        </div>\n    </div>\n\n    <form role="form" class="spacer" method="post" ng-submit="ok()">\n        <div class="row form-group">\n            <label class="col-sm-4 control-label required" translate>\n                loginFrontend.smsCode\n            </label>\n\n            <div class="col-sm-8">\n                <input type="tel"\n                       pattern="[0-9]*"\n                       ng-model="smsCode"\n                       class="form-control"\n                       name="smsCode"\n                       id="smsCode"\n                       maxlength="6"\n                       required="required"\n                       autocomplete="off"/>\n                <p class="help-block" translate>\n                    loginFrontend.always6digits\n                </p>\n            </div>\n        </div>\n        <div class="row form-group">\n            <div class="col-sm-offset-4 col-sm-8 ">\n                <div class="checkbox custom">\n                    <input type="checkbox" ng-model="markDeviceAsTrusted" name="markDeviceAsTrusted"\n                           id="markDeviceAsTrusted"/>\n                    <label class="m-label" translate for="markDeviceAsTrusted">\n                        loginFrontend.markDeviceAsTrusted\n                    </label>\n                </div>\n            </div>\n        </div>\n        <div ng-if="totpAuthenticationEnabled" class="row form-group">\n            <div class="col-sm-offset-4 col-sm-8 ">\n                <span translate>loginFrontend.smsProblem</span>\n                <button type="button" id="totpFormLink" class="btn btn-link" ng-click="goToTotpVerification()">\n                    <span translate>loginFrontend.goToTotpVerification</span>\n                </button>\n            </div>\n        </div>\n\n    </form>\n\n    <div class="row">\n        <div class="col-sm-6 col-sm-push-6 text-right spacer">\n            <button id="smsLoginButton" type="submit" ng-click="ok()" class="btn btn-primary btn-send-code" translate>loginFrontend.done</button>\n        </div>\n        <div class="col-sm-1 col-sm-pull-2 text-center">\n            <button id="smsLoginCancelLink" class="btn btn-link" ng-click="cancel()">\n                <span translate>loginFrontend.cancel</span>\n            </button>\n        </div>\n    </div>\n\n</div>\n'),$templateCache.put("totpVerification.tpl.html",'<header class="page-header separator separator-bottom col-sm-12 col-md-12 ng-scope">\n    <div class="col-sm-9 col-sm-offset-1 col-md-12 col-md-offset-0 ng-scope">\n        <h1 class="page-default" translate>loginFrontend.provideTotp</h1>\n    </div>\n</header>\n\n<div class="form-center">\n\n    <div ng-if="totpValidationError" class="form-group" ng-cloak="">\n        <div class="col-xm-10 col-xm-offset-1 col-sm-8 col-sm-offset-4 error-box">\n            <div class="alert alert-danger pull-left" ng-class="{ \'hide-alert\': hideAlert }">\n                <h4 translate>loginFrontend.totpValidationErrorTitle</h4>\n                <span translate>loginFrontend.totpValidationError</span>\n            </div>\n        </div>\n    </div>\n\n    <form role="form" class="spacer" method="post" ng-submit="ok()">\n        <div class="row form-group">\n            <label class="col-sm-4 control-label required" translate>\n                loginFrontend.totp\n            </label>\n\n            <div class="col-sm-8">\n                <input type="tel"\n                       pattern="[0-9]*"\n                       ng-model="totp"\n                       class="form-control"\n                       name="totp"\n                       id="totp"\n                       maxlength="6"\n                       required="required"\n                       autocomplete="off"/>\n            </div>\n        </div>\n        <div class="row form-group">\n            <div class="col-sm-offset-4 col-sm-8 ">\n                <div class="checkbox custom">\n                    <input type="checkbox" ng-model="markDeviceAsTrusted" name="markDeviceAsTrusted"\n                           id="markDeviceAsTrusted"/>\n                    <label class="m-label" translate for="markDeviceAsTrusted">\n                        loginFrontend.markDeviceAsTrustedOnTotp\n                    </label>\n                </div>\n            </div>\n        </div>\n        <div class="form-group input-group-validation" ng-if="showRecaptcha">\n            <label translate class="col-sm-4 control-label">\n                loginFrontend.captchaLabel\n            </label>\n            <div class="col-sm-8">\n                <div\n                        vc-recaptcha="vc-recaptcha"\n                        key="\'6Lf2QRITAAAAALCZv7ic-HUmW8z5Ae64h5a7umyb\'"\n                        on-create="setWidgetId(widgetId)"\n                        on-success="onCaptchaSuccess()"\n                        on-expire="onCaptchaExpiration()">\n                </div>\n                <div ng-if="recaptchaStatus.showRequired" class="recaptcha-width validation-message in" ng-cloak="">\n                    <div id="captcha-required" translate>loginFrontend.captchaRequired</div>\n                </div>\n            </div>\n        </div>\n        <div class="row form-group">\n            <div class="col-sm-offset-4 col-sm-8 ">\n                <span translate>loginFrontend.totpProblem</span>\n                <button type="button" id="smsFormLink" class="btn btn-link" ng-click="goToSmsVerification()">\n                    <span translate>loginFrontend.goToSmsVerification</span>\n                </button>\n            </div>\n        </div>\n\n    </form>\n\n    <div class="row">\n        <div class="col-sm-6 col-sm-push-6 text-right spacer">\n            <button id="totpLoginButton" type="submit" ng-click="ok()" class="btn btn-primary btn-send-code" translate>loginFrontend.done</button>\n        </div>\n        <div class="col-sm-1 col-sm-pull-2 text-center">\n            <button id="totpLoginCancelLink" class="btn btn-link" ng-click="cancel()">\n                <span translate>loginFrontend.cancel</span>\n            </button>\n        </div>\n    </div>\n\n</div>\n');
}]),angular.module("loginFrontend").controller("TotpVerificationCtrl",["$scope","$stateParams","$window","$http","$log","$state","TranslatorService","CookieMonsterService",function($scope,$stateParams,$window,$http,$log,$state,translatorService,cookieMonsterService){var redirectUrl=$stateParams.redirectUrl;$scope.phoneMask=$stateParams.phoneMask,$scope.markDeviceAsTrusted=!0,$scope.recaptchaStatus={empty:!0,showRequired:!1,isValid:function(){return!$scope.showRecaptcha||!this.empty},resetCaptcha:function(){$scope.showRecaptcha&&grecaptcha.reset($scope.widgetId)}},$scope.setWidgetId=function(widgetId){$scope.widgetId=widgetId},$("#totp").focus(),$scope.ok=function(){if($scope.hideAlert=!0,!$scope.recaptchaStatus.isValid())return void($scope.recaptchaStatus.showRequired=!0);var recaptchaResponse=document.querySelector(".g-recaptcha-response"),request={method:"POST",url:"/login/authenticate",headers:{"Content-Type":"application/json"},data:{totp:$scope.totp,authorizationUri:redirectUrl,recaptchaResponse:recaptchaResponse?recaptchaResponse.value:null,markDeviceAsTrusted:$scope.markDeviceAsTrusted,authenticationMethod:"TOTP"}};$http(request).then(function(response){$log.debug("TOTP verification login success",response),cookieMonsterService.send2FAVerifiedEvent("totp",$scope.markDeviceAsTrusted),$window.location.href=response.data.redirectUrl},function(response){var responseMessage=JSON.parse(response.data.message);$log.debug("TOTP verification login failed",response),401===response.data.status&&null!==responseMessage.passwordChangeUrl&&($window.location.href=responseMessage.passwordChangeUrl),$scope.recaptchaStatus.resetCaptcha(),$scope.hideAlert=!1,$scope.totpValidationError=responseMessage.totpValidationError,$scope.recaptchaError=responseMessage.recaptchaError,$scope.showRecaptcha=responseMessage.showRecaptcha})},$scope.goToSmsVerification=function(){var request={method:"POST",url:"/login/sms-code"};$http(request).then(function(){$scope.showSmsVerification(null)},function(response){$scope.showSmsVerification(translatorService.translateSmsError(response.data[0].code))})},$scope.cancel=function(){$window.location.href="/"},$scope.showSmsVerification=function(sendSmsErrorCode){$state.go("sms-verification",{phoneMask:$scope.phoneMask,redirectUrl:redirectUrl,sendSmsErrorCode:sendSmsErrorCode,totpAuthenticationEnabled:!0})},$scope.onCaptchaSuccess=function(){$scope.recaptchaStatus.empty=!1,$scope.recaptchaStatus.showRequired=!1},$scope.onCaptchaExpiration=function(){$scope.recaptchaStatus.empty=!0}}]),angular.module("loginFrontend").run(function(gettextCatalog){gettextCatalog.setStrings("pl",{"loginForm.userAgreementFirstPart":"Zalogowanie oznacza akceptację","loginForm.userAgreementSecondPart":"Regulaminu Allegro","loginForm.userAgreementThirdPart":"w aktualnym brzmieniu.","loginFrontend.addToTrustedDevices":"dodaj to urządzenie do zaufanych","loginFrontend.always6digits":"kod jest zawsze 6-cyfrowy","loginFrontend.buyWithoutLogin":"kup bez logowania","loginFrontend.buyWithoutLoginButton":"kup bez konta","loginFrontend.cancel":"anuluj","loginFrontend.captchaLabel":"potwierdź, że jesteś człowiekiem","loginFrontend.captchaRequired":"pole wymagane","loginFrontend.codeSentToNumber":"SMS z kodem wysłaliśmy pod numer:","loginFrontend.CODE_SENDING_LIMIT_EXCEEDED":"Przekroczono limit. Spróbuj ponownie za godzinę.","loginFrontend.confirmEmail":"Potwierdź swój e-mail","loginFrontend.done":"gotowe","loginFrontend.errorCaptchaMessage":"Spróbuj zalogować się ponownie.","loginFrontend.errorCaptchaTitle":"Coś poszło nie tak.","loginFrontend.errorMessage":"Upewnij się, że wpisujesz poprawne dane.","loginFrontend.errorTitle":"Login, e-mail lub hasło są nieprawidłowe","loginFrontend.facebookPermissionDidascalia":"Nie opublikujemy nic bez Twojej zgody.","loginFrontend.formExpired":"Twój formularz stracił ważność. Prosimy odświeżyć stronę.","loginFrontend.guestFormLoginHeader":"zaloguj się","loginFrontend.guestLoginBoxPros":"bez ograniczeń, szybko, bezpiecznie","loginFrontend.logIntoTrustedDevice":"Jeśli kod nie dotarł, albo nie masz telefonu, zaloguj się na którymś z Twoich zaufanych urządzeń. Na nim nie musisz podawać kodu SMS.","loginFrontend.loginButton":"Zaloguj się","loginFrontend.loginEmailErrorMessage":"podaj login lub e-mail","loginFrontend.loginEmailLabel":"login lub e-mail","loginFrontend.loginHeader":"zaloguj się","loginFrontend.loginWithFacebookButton":"zaloguj się z Facebookiem","loginFrontend.newGuestBuyWithoutLoginName":"nie masz konta?","loginFrontend.newGuestLoginNote1":"Jeśli nie chcesz teraz zakładać konta, możesz zrobić zakupy bez rejestracji.","loginFrontend.newGuestLoginNote2":"To Ty decydujesz, jak chcesz kupić:","loginFrontend.newGuestLoginNote3":"zrób zakupy bez zakładania konta","loginFrontend.newGuestLoginNote4":"załóż konto w trakcie zakupów.","loginFrontend.noAccount":"nie masz konta?","loginFrontend.ok":"ok","loginFrontend.orSeparator":"lub","loginFrontend.passwordErrorMessage":"podaj hasło","loginFrontend.passwordLabel":"hasło","loginFrontend.passwordReminder":"nie pamiętasz hasła?","loginFrontend.provideSmsCode":"Podaj kod SMS","loginFrontend.registrationIncomplete":"Adres e-mail:","loginFrontend.registrationIncompleteInfo":"nie został potwierdzony przy rejestracji. Odbierz wiadomość, którą na ten adres wysłaliśmy i potwierdź rejestrację.","loginFrontend.sendNewCode":"wyślij nowy kod","loginFrontend.smsCode":"kod SMS","loginFrontend.UNEXPECTED_ERROR":"Wystąpił nieoczekiwany błąd. Spróbuj ponownie.","loginFrontend.smsErrorTitle":"Błąd podczas wysyłki kodu SMS","loginFrontend.smsValidationErrorTitle":"Błąd podczas weryfikacji kodu SMS","loginFrontend.CODE_EXPIRED":"Kod wygasł","loginFrontend.INVALID_CODE":"Nieprawidłowy kod","loginFrontend.CODE_VERIFICATION_LIMIT_EXCEEDED":"Przekroczono limit weryfikacji kodu","loginFrontend.PHONE_NUMBER_NOT_FOUND":"Nie można zweryfikować kodu","loginFrontend.PHONE_NUMBER_ON_BLACKLIST":"Nie można zweryfikować kodu dla podanego numeru telefonu","loginFrontend.userAgreementLastUpdate":"zobacz ostatnią aktualizację z dnia","loginFrontend.userAgreementLastUpdateWithoutDate":"zobacz ostatnią aktualizację","loginFrontend.markDeviceAsTrusted":"nie pytaj ponownie na tym urządzeniu","loginFrontend.goToTotpVerification":"zaloguj się kodem z aplikacji","loginFrontend.provideTotp":"Podaj kod z aplikacji","loginFrontend.totpValidationErrorTitle":"Błąd podczas weryfikacji kodu z aplikacji","loginFrontend.totpValidationError":"Niepoprawny kod","loginFrontend.totp":"Kod weryfikacyjny","loginFrontend.markDeviceAsTrustedOnTotp":"nie pytaj ponownie o kod na tym urządzeniu","loginFrontend.smsProblem":"SMS nie przyszedł?","loginFrontend.totpProblem":"Problem z kodem z aplikacji?","loginFrontend.goToSmsVerification":"zaloguj się kodem SMS","loginFrontend.newLoginNotification.title":"Dlaczego ta strona wygląda inaczej?","loginFrontend.newLoginNotification.body":"Odświeżyliśmy dla Ciebie Allegro. Nowy wygląd, zawsze bezpieczne logowanie.","loginFrontend.newLoginNotification.close":"rozumiem"}),gettextCatalog.setStrings("en",{"loginForm.userAgreementFirstPart":"By logging on you accept the","loginForm.userAgreementSecondPart":"User Agreement","loginForm.userAgreementThirdPart":"in its present wording.","loginFrontend.addToTrustedDevices":"add this device to trusted devices","loginFrontend.always6digits":"code contains 6 digits","loginFrontend.buyWithoutLogin":"checkout as a guest","loginFrontend.buyWithoutLoginButton":"guest checkout","loginFrontend.cancel":"cancel","loginFrontend.captchaLabel":"confirm that you are a man","loginFrontend.captchaRequired":"required","loginFrontend.codeSentToNumber":"We have sent the SMS code to the following number:","loginFrontend.CODE_SENDING_LIMIT_EXCEEDED":"Limit exceeded. Please try again in an hour.","loginFrontend.confirmEmail":"Confirm your e-mail address","loginFrontend.done":"done","loginFrontend.errorCaptchaMessage":"Try to log in again.","loginFrontend.errorCaptchaTitle":"Something went really wrong.","loginFrontend.errorMessage":"Make sure you provide correct data.","loginFrontend.errorTitle":"Username, e-mail or password are incorrect","loginFrontend.facebookPermissionDidascalia":"We will not publish anything without yor consent.","loginFrontend.formExpired":"Your login form has expired. Please refresh this page.","loginFrontend.guestFormLoginHeader":"log on","loginFrontend.guestLoginBoxPros":"no restrictions, quick and secure","loginFrontend.logIntoTrustedDevice":"If you have not received the code, or you do not have a mobile phone, log in using one of your trusted devices as such devices do not require the code.","loginFrontend.loginButton":"Log on","loginFrontend.loginEmailErrorMessage":"provide username or e-mail","loginFrontend.loginEmailLabel":"username or e-mail","loginFrontend.loginHeader":"log on","loginFrontend.loginWithFacebookButton":"Log on with Facebook","loginFrontend.noAccount":"no account?","loginFrontend.ok":"ok","loginFrontend.passwordErrorMessage":"provide password","loginFrontend.passwordLabel":"password","loginFrontend.passwordReminder":"forgot your password?","loginFrontend.provideSmsCode":"Provide SMS code","loginFrontend.registrationIncomplete":"E-mail address:","loginFrontend.registrationIncompleteInfo":"has not been confirmed upon registration. Check the message we have sent to this address and confirm registration.","loginFrontend.sendNewCode":"send new code","loginFrontend.smsCode":"SMS code","loginFrontend.UNEXPECTED_ERROR":"Try again using 'Send SMS code' button","loginFrontend.smsErrorTitle":"Error while sending the SMS code","loginFrontend.smsValidationErrorTitle":"Error while verifying SMS code","loginFrontend.CODE_EXPIRED":"Code expired","loginFrontend.INVALID_CODE":"Wrong code","loginFrontend.CODE_VERIFICATION_LIMIT_EXCEEDED":"Code verification limit exceeded","loginFrontend.PHONE_NUMBER_NOT_FOUND":"Code cannot be verified","loginFrontend.PHONE_NUMBER_ON_BLACKLIST":"Code cannot be verified for this phone number","loginFrontend.userAgreementLastUpdate":"view the recent update made on","loginFrontend.userAgreementLastUpdateWithoutDate":"view the recent update","loginFrontend.newLoginNotification.title":"Why does this page look different?","loginFrontend.newLoginNotification.body":"We have updated Allegro for you. New look, always secure login.","loginFrontend.newLoginNotification.close":"close"})}),angular.module("loginFrontend").service("TranslatorService",["gettextCatalog",function(gettextCatalog){var smsErrorTranslationVariablePrefix="loginFrontend.",defaultErrorCode=smsErrorTranslationVariablePrefix+"UNEXPECTED_ERROR";this.translateSmsError=function(errorCode){if(!errorCode)return null;var toTranslate=smsErrorTranslationVariablePrefix+errorCode,translated=gettextCatalog.getString(toTranslate);return translated===toTranslate?gettextCatalog.getString(defaultErrorCode):translated}}]),angular.module("loginFrontend").service("ValveFingerprintjs2",[function(){function isWebglBlocked(){try{return document.createElement("canvas").getContext("webgl").canvas.toDataURL(),!1}catch(e){return!0}}var excludeOptions={excludeAvailableScreenResolution:!0,excludeScreenResolution:!0,excludeWebGL:isWebglBlocked()};return new Fingerprint2(excludeOptions)}]);